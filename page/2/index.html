<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.dujiajun.site","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="一无是处杜某某">
<meta property="og:url" content="http://blog.dujiajun.site/page/2/index.html">
<meta property="og:site_name" content="一无是处杜某某">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="杜某某">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.dujiajun.site/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>一无是处杜某某</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?34f7210ec82752a9bbc5d28884db07fb"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">一无是处杜某某</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">或许是东川路第一老实人</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">杜某某</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/12/23/%E5%BE%AE%E4%BF%A1%E5%AE%89%E5%85%A8%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AEmmtls%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/23/%E5%BE%AE%E4%BF%A1%E5%AE%89%E5%85%A8%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AEmmtls%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">微信安全通信协议mmtls分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-23 13:16:42" itemprop="dateCreated datePublished" datetime="2019-12-23T13:16:42+08:00">2019-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文为现代密码学课程作业。</p>
</blockquote>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>mmtls协议是TLS1.3版本的简化版或者改良版。由于TLS1.3长期处于草案状态，微信团队需要进行安全通信协议设计又无法直接使用TLS1.3协议，因此微信决定采用TLS1.3草案中的一些标准，设计了自己的mmtls协议。mmtls在微信通信层次中属于介于应用层和网络连接层之间的层次，类似于TLS在HTTP与TCP之间的位置。</p>
<p>微信通信过程中使用TCP进行报文传输，微信通信分为长连接和短连接两种。其中短连接使用HTTP协议加上mmtls，长连接使用私有协议加上mmtls。从内部来说，mmtls有三个子协议：Record协议、Handshake协议和Alert协议。其中Alert协议和Handshake协议作为Record协议的上层。</p>
<h2 id="认证密钥协商：Handshake协议"><a href="#认证密钥协商：Handshake协议" class="headerlink" title="认证密钥协商：Handshake协议"></a>认证密钥协商：Handshake协议</h2><p>TLS1.3中提出了2中1-RTT密钥协商方式（1-RTT ECDHE和1-RTT PSK）和4种0-RTT密钥协商方式（0-RTT ECDH、0-RTT PSK、0-RTT ECHD-ECDHE、0-RTT PSK-ECDHE），mmtls只选择了1-RTT ECDHE、1-RTT PSK和0-PSK 三种方式。其中长连接使用1-RTT ECDHE和1-RTT PSK，短连接使用0-PSK。</p>
<h3 id="1-RTT-ECDHE密钥协商"><a href="#1-RTT-ECDHE密钥协商" class="headerlink" title="1-RTT ECDHE密钥协商"></a>1-RTT ECDHE密钥协商</h3><p>普通的D-H密钥协商存在被中间人攻击的可能，需要对协商数据进行身份认证，即“带认证的密钥协商”。认证有两种方式，基于MAC的对称方式和基于数字签名的非对称方式。mmtls采用数字签名的方式，使用的算法叫做ECDSA。通信双方进行密钥协商的时候，分别运行签名算法对自己的公钥进行签名，收到对方的信息后首先要验证签名，签名正确再进行密钥协商。mmtls协议中只对服务器端进行认证，不对客户端进行认证。</p>
<p>ECDSA的过程为，服务器收到客户端的<code>cli_pub_key</code>之后，随机一对ECDH密钥<code>svr_pub_key</code>、<code>svr_pro_key</code>，用签名密钥<code>sign_key</code>对<code>svr_pub_key</code>签名得到签名值，将签名值和<code>svr_pub_key</code>一同发给客户端。客户端收到之后用<code>verify_key</code>进行验证，验证成功之后再继续协商密钥。其中<code>verify_key</code>直接内置在微信客户端内。</p>
<h3 id="1-RTT-PSK密钥协商"><a href="#1-RTT-PSK密钥协商" class="headerlink" title="1-RTT PSK密钥协商"></a>1-RTT PSK密钥协商</h3><p>PSK是ECDH握手中服务器下发的，包含作对称加密密钥的key以及用ticket_key对key加密后的密文ticket。PSK在安全信道中传输，只有服务器知道ticket_key。PSK协商过程中，客户端将ticket发给服务器，服务器将ticket解密后得到key，再用key计算协商的数据的HMAC进行认证。PSK使用的是对称密钥。</p>
<h3 id="0-RTT-PSK密钥协商"><a href="#0-RTT-PSK密钥协商" class="headerlink" title="0-RTT PSK密钥协商"></a>0-RTT PSK密钥协商</h3><p>在1-RTT PSK握手之前，客户端已经得到了一个对称加密密钥，可以直接用这个密钥加密数据，和ticket一起发送给服务器，节约一个轮次。</p>
<h2 id="对称加密传输：Record协议"><a href="#对称加密传输：Record协议" class="headerlink" title="对称加密传输：Record协议"></a>对称加密传输：Record协议</h2><p>经过握手之后，客户端和服务器端协商出了对称加密密钥<code>pre_master_key</code>。我们需要加密也需要认证，在TLS1.3中只能使用AEAD类（将Encrypt和MAC集成在算法内部）的算法进行加密。mmtls选择了AES-GCM作为认证加密算法。AES-GCM中，AES为加密算法，GCM指采用Counter模式，并带有GMAC消息认证码。</p>
<p>对称加密需要6个加密参数，分别是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Client Write MAC Key （用于 Client 算消息认证码，以及 Server 验证消息认证码）</span><br><span class="line">Server Write MAC Key （用于 Server 算消息认证码，以及 Client 验证消息认证码）</span><br><span class="line">Client Write Encryption Key（用做 Client 做加密，以及 Server 解密）</span><br><span class="line">Server Write Encryption Key（用做 Server 做加密，以及 Client 解密）</span><br><span class="line">Client Write IV （Client 加密时使用的初始化向量）</span><br><span class="line">Server Write IV （Server 加密时使用的初始化向量）</span><br></pre></td></tr></table></figure>

<p><code>pre_master_key</code>只有48字节，不能满足上述6个参数的需要，需要对密钥进行扩展。mmtls使用的是HKDF进行密钥扩展。在0-RTT下的<code>pre_master_key</code>可能会有两个，<code>Static Secret</code> 和 <code>Ephemeral Secret</code>。HKDF定义了两个函数进行扩展，<code>HKDF-Extract</code>保证密钥的熵均匀、伪随机性足够，<code>HKDF-Expand</code>对密钥的长度进行扩展。在mmtls中，<code>pre_master_key</code>进过扩展，得到长度为<code>2*enc_key_length 2*iv_length</code>的一段buffer，称为<code>key_block</code>。剩下的4个参数就用<code>key_block</code>中截取的一部分代表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client_write_key = key_block[0...enc_key_length-1]</span><br><span class="line">client_write_key = key_block[enc_key_length...2*enc_key_length-1]</span><br><span class="line">client_write_IV  = key_block[2*enc_key_length...2*enc_key_length iv_length-1]</span><br><span class="line">server_write_IV  = key_block[2*enc_key_length iv_length...2*enc_key_length 2*iv_length-1]</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>mmtls参考了TLS1.3草案，结合微信自身背景，在密钥协商过程中使用ECDH，签名验证中使用ECDSA，认证加密中使用AES-GCM，密钥扩展中使用HKDF，摘要算法使用SHA256。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/12/05/%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E5%AD%A6%E9%99%A2%E5%9F%B9%E5%85%BB%E4%BD%93%E7%B3%BB%E5%BA%A7%E8%B0%88%E4%BC%9A%E5%BB%BA%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/05/%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E5%AD%A6%E9%99%A2%E5%9F%B9%E5%85%BB%E4%BD%93%E7%B3%BB%E5%BA%A7%E8%B0%88%E4%BC%9A%E5%BB%BA%E8%AE%AE/" class="post-title-link" itemprop="url">网络空间安全学院培养体系座谈会建议</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-05 13:11:12" itemprop="dateCreated datePublished" datetime="2019-12-05T13:11:12+08:00">2019-12-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网络空间安全学院培养体系座谈会建议"><a href="#网络空间安全学院培养体系座谈会建议" class="headerlink" title="网络空间安全学院培养体系座谈会建议"></a>网络空间安全学院培养体系座谈会建议</h1><blockquote>
<p>在2019年12月5日网络空间安全学院培养体系座谈会上本人提出的建议</p>
</blockquote>
<h2 id="一、加强计算机能力与安全能力培养，削减通信类课程学分"><a href="#一、加强计算机能力与安全能力培养，削减通信类课程学分" class="headerlink" title="一、加强计算机能力与安全能力培养，削减通信类课程学分"></a>一、加强计算机能力与安全能力培养，削减通信类课程学分</h2><ol>
<li>   提升计算机组成与体系结构学分，或者与计算机系合上。</li>
<li>   取消1学分软件工程，与应用软件课程设计合并。</li>
<li>   彻底更换计算机通信网络、操作系统教材，使用国外优秀教材。</li>
<li>   更改嵌入式系统原理与应用课程内容，与电院其他专业合上。</li>
<li>   增强计算机组成、数据库原理、编译原理、Windows安全原理与技术的实践内容。</li>
<li>   开设Web安全、二进制安全、Linux内核、汇编语言、多媒体分析等方面的选修课。</li>
<li>   在小学期开设安全实践（CTF等）、课程设计的专业选修课。</li>
<li>   将模拟电子技术、信号与系统、Windows安全原理与技术改为选修课。</li>
<li>   考虑将数字信号处理与电子系合上。</li>
</ol>
<h2 id="二、调整课程时序，提升课程质量"><a href="#二、调整课程时序，提升课程质量" class="headerlink" title="二、调整课程时序，提升课程质量"></a>二、调整课程时序，提升课程质量</h2><ol>
<li>   考虑将信息安全综合实践与网络信息安全概论安排到同一学期或者相邻2学期。</li>
<li>   统筹网络信息安全概论、信息安全综合实践、现代密码学中涉及到密码学和信息安全基础概念的部分，避免重复。</li>
<li>   统筹数字系统设计、电子技术试验、数字电子技术的顺序和内容，做到有序衔接。</li>
</ol>
<h2 id="三、营造良好科研氛围，开设利于科研的项目"><a href="#三、营造良好科研氛围，开设利于科研的项目" class="headerlink" title="三、营造良好科研氛围，开设利于科研的项目"></a>三、营造良好科研氛围，开设利于科研的项目</h2><h2 id="四、改进教学管理"><a href="#四、改进教学管理" class="headerlink" title="四、改进教学管理"></a>四、改进教学管理</h2><ol>
<li>   放开专业选修课的容量，从大三上开始开放专业选修课，增强选课的自由度。</li>
<li>   将每学期的课程大作业错峰设置，避免截止日期扎堆。</li>
</ol>
<h1 id="新课程体系初步意见"><a href="#新课程体系初步意见" class="headerlink" title="新课程体系初步意见"></a>新课程体系初步意见</h1><blockquote>
<p>在2019年12月5日网络空间安全学院培养体系座谈会老师给出的培养计划草案</p>
</blockquote>
<h2 id="一、划分专业方向，减轻学分压力。"><a href="#一、划分专业方向，减轻学分压力。" class="headerlink" title="一、	划分专业方向，减轻学分压力。"></a>一、	划分专业方向，减轻学分压力。</h2><p>设立密码与应用、网络与通信安全、系统安全与攻防、应用（内容、AI）安全四个方向。大二下开始通过重新设计的信息安全科技创新了解各方向，大三上进入各方向课程学习。将信息安全高年级课程划分为方向基础课、方向必选课，专业选修课。</p>
<h2 id="二、调整课程时序，强化代码能力。"><a href="#二、调整课程时序，强化代码能力。" class="headerlink" title="二、	调整课程时序，强化代码能力。"></a>二、	调整课程时序，强化代码能力。</h2><p>将离散数学、数据结构、安全概论、信安数基、操作系统、编译原理等课程提前安排。强化现有计算机基础课程的实践部分。新设立安全代码编写、安全开发模型等课程。考虑在小学期设立编程实践课程。</p>
<h2 id="三、增强安全能力，削减通信课程。"><a href="#三、增强安全能力，削减通信课程。" class="headerlink" title="三、	增强安全能力，削减通信课程。"></a>三、	增强安全能力，削减通信课程。</h2><p>新设立逆向分析、攻防实战、密码工程实践、密码分析学、安全法规、网络舆情、大数据安全、系统安全思维、机器学习、无线网络安全、硬件安全、软件安全等课程。取消数电、模电、电子技术实验、信号与系统、数字信号处理、信息论与编码、Verilog、FPGA实验、嵌入式等课程的必修课地位。</p>
<h2 id="四、构建课程体系，实现贯通培养。"><a href="#四、构建课程体系，实现贯通培养。" class="headerlink" title="四、	构建课程体系，实现贯通培养。"></a>四、	构建课程体系，实现贯通培养。</h2><p>重新调整信息安全科技创新、应用软件课程设计和系统软件课程、毕业设计的定位与内容，实现方向内课程内容的连续性，考虑课程内进行对大型工程的持续开发。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/09/08/%E5%A4%A7%E4%B8%89%E4%B8%8B%E5%AD%A6%E6%9C%9F%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/09/08/%E5%A4%A7%E4%B8%89%E4%B8%8B%E5%AD%A6%E6%9C%9F%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">大三下学期总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-08 13:15:06" itemprop="dateCreated datePublished" datetime="2019-09-08T13:15:06+08:00">2019-09-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>时光飞逝，在交大已经生活学习了3年的我，已经进入本科最后一年了。大三下学期对我来说，是一个不平凡的学期。不平凡表现在几个方面。</p>
<p>一是学习成绩。大三下学期的课程对我来说，大多数属于实践性很强的课，而非理论性的做题的课程。我对于这种实践性的课程的投入度比较高。再加上大作业都是以小组作业的形式，带领团队进行攻关对我来说也是一种学习的过程。最后的结果反映就是，没有一门课出现分数爆炸的情况，所有课程的分数都符合我的预期，总的学积分一下子提高了很多。尽管如此，由于不知道其他人的成绩，我尚不知道我的排名究竟有何变化。</p>
<p>二是参加比赛。整个大三下学期都在准备信安竞赛。参加比赛一方面是为了获奖有保研加分，另一方面是体验实验室的经历、积累项目开发的经验。我们选择的题目是“AI换脸视频检测”，在孙锬锋老师和信息认知实验室的指导下，我和另外三位同学经过调研、设计、实验、系统开发、测试等多个环节，做出的作品和报告成功入围决赛。等到小学期的时候再在学校调试和准备展示效果，最后在东南大学比赛中，取得一等奖。</p>
<p>这些经历一扫过去几个学期平平淡淡的阴霾，让我的生涯履历中又添加了几笔着墨之处。</p>
<p>现在已经大四，我已经思考好了未来的选择，我将选择继续在交大读研深造。但是目前看上去我的学积分排名尚且不能够到推免资格，即便有着竞赛加分我也不知道究竟能否推免。因此我正在准备考研。我知道考研相对而言是比较辛苦的，需要和其他同学或者外校的学生一起竞争仅有的若干名额。但是我相信身为交大学子，有着能够轻松考上本校的水平。还有选择研究生的方向。我是否要考本专业，或者选择哪个老师，这些问题我还没有思考好。这是我接下来一段时间需要了解调研和思考决策的事情。</p>
<p>另外，即便大四，我还有4门专业课程需要学习。我将妥善分配我的精力与时间，争取复习考研的同时，也学好专业课的内容。毕竟不只是成绩很重要，课上学到的知识也是非常有用的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/06/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%88%E5%88%98%E5%8A%9F%E7%94%B3%EF%BC%89%E6%9C%80%E5%90%8E%E4%B8%80%E8%8A%82%E8%AF%BE%E5%86%85%E5%AE%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%88%E5%88%98%E5%8A%9F%E7%94%B3%EF%BC%89%E6%9C%80%E5%90%8E%E4%B8%80%E8%8A%82%E8%AF%BE%E5%86%85%E5%AE%B9/" class="post-title-link" itemprop="url">操作系统（刘功申）最后一节课内容</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-14 13:25:26" itemprop="dateCreated datePublished" datetime="2019-06-14T13:25:26+08:00">2019-06-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文为操作系统课程期末复习课内容，作者为小笼包</p>
</blockquote>
<h2 id="操作系统概述"><a href="#操作系统概述" class="headerlink" title="操作系统概述"></a>操作系统概述</h2><ul>
<li>绝对不会考什么是操作系统，但是可能出现在简答和判断题里</li>
<li>关于操作系统的回顾（理解）</li>
<li><ul>
<li>以技术的转折点为主导</li>
<li>作业题里面</li>
<li>为什么有这项技术，这项技术解决了什么问题</li>
<li><ul>
<li>缓存、中断、DMA、多道程序、SPOOLING等</li>
</ul>
</li>
</ul>
</li>
<li>操作系统的概念</li>
<li><ul>
<li>PPT：微机操作系统</li>
<li>理解性的，选择判断</li>
</ul>
</li>
<li>操作系统的特征</li>
<li><ul>
<li>经常提问的</li>
<li>并发、共享、虚拟、不确定性</li>
</ul>
</li>
<li>操作系统的几大功能</li>
<li><ul>
<li>按照章节来</li>
<li>进程、存储、设备、文件、用户接口</li>
</ul>
</li>
<li>作业题要看</li>
</ul>
<h2 id="存储管理"><a href="#存储管理" class="headerlink" title="存储管理"></a>存储管理</h2><ul>
<li>内存管理的需求</li>
<li><ul>
<li>挺核心的，但是书上没有</li>
</ul>
</li>
<li>可变分区分配算法</li>
<li><ul>
<li>首次、邻近、最佳、最差</li>
</ul>
</li>
<li>内存扩充技术</li>
<li><ul>
<li>覆盖、虚拟</li>
<li>这种概念要理清楚</li>
</ul>
</li>
<li>新分区思想</li>
<li><ul>
<li>一定理解</li>
<li>分页、分段</li>
</ul>
</li>
<li>逻辑地址到物理地址的转换</li>
<li><ul>
<li>特别核心的一大块</li>
<li>但是书上有些东西没有，教材上没有的肯定不会考</li>
<li>页表</li>
<li><ul>
<li>各种转换方式，书上有的一定都是重点</li>
<li>快表、多级页表</li>
<li>反向页表不会考</li>
</ul>
</li>
</ul>
</li>
<li>局部性原理</li>
<li><ul>
<li>必须理解</li>
<li>“有哪些地方用到了局部性原理？”</li>
</ul>
</li>
<li>淘汰算法</li>
<li><ul>
<li>一共也没有几个，比较重点的是Clock算法（书P33上面的解释要看）</li>
<li>FIFO、矩阵法，这都是课本上有的，但是可能不太重要，也不能忽略</li>
</ul>
</li>
<li>后面书上没有的的就算了</li>
<li><ul>
<li>驻留集、清除策略、装入控制这都不考</li>
</ul>
</li>
<li>具体实例关注Unix</li>
<li><ul>
<li>Lazy Buddy要知道</li>
<li>页面分配和回收</li>
<li><ul>
<li>Age</li>
<li>为什么设置最大年龄值等问题</li>
</ul>
</li>
</ul>
</li>
<li>本章的三大部分</li>
<li><ul>
<li>分页分段（内存管理）</li>
<li>地址转换</li>
<li>淘汰算法</li>
</ul>
</li>
</ul>
<h2 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h2><ul>
<li>这部分占用两章，课时最多，分数也最重</li>
<li>进程的状态及其转换</li>
<li><ul>
<li>我们只考3状态，但是考研考5状态</li>
<li>状态之间转换的原因（事件）</li>
<li>哪些状态之间不能转换</li>
</ul>
</li>
<li>挂起状态书上好像是有的？（确认一下）</li>
<li>进程映像中的数据</li>
<li><ul>
<li>不用背数据结构，但是文字要掌握？</li>
<li>PPT pp.38这种不用背</li>
</ul>
</li>
<li>CPU模式就丢了（书上没有）</li>
<li><ul>
<li>用户模式、内核模式</li>
</ul>
</li>
<li>操作系统的类型</li>
<li><ul>
<li>没有内核、内核和用户编在一起、内核独立的</li>
<li>内核与进程是否编在一起的三种方式</li>
</ul>
</li>
<li>线程和进程的区别</li>
<li><ul>
<li>为什么要做线程，克服了进程的哪些缺点</li>
</ul>
</li>
<li>用户级多线程、内核级、混合方法实现的多线程</li>
<li>Windows就算了</li>
<li>调度算法</li>
<li><ul>
<li>高级调度、中级调度、低级调度</li>
<li>最容易出选择和判断题</li>
<li>区分清楚三种不同级别线程调度中，低级调度调度的是谁</li>
</ul>
</li>
<li>作业调度，可以就当进程调度来理解</li>
<li><ul>
<li>周转时间、带权周转时间搞清楚</li>
</ul>
</li>
<li>常用调度算法</li>
<li><ul>
<li>PPT pp.110，越往后越核心</li>
<li>必须理解的内容</li>
</ul>
</li>
<li>实时调度</li>
<li><ul>
<li>书上讲的很少，书上没有的就不要了</li>
<li>书上没有优先级逆转</li>
</ul>
</li>
<li>多处理器调度</li>
<li><ul>
<li>书上好像只有，群调度算法</li>
<li>其他的就算了</li>
</ul>
</li>
</ul>
<h2 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h2><ul>
<li>多线程并发执行带来的问题</li>
<li>《此处漏了一部分》</li>
<li>Peterson的算法描述要有</li>
<li>信号量</li>
<li><ul>
<li><strong>重点（这个是必考的）</strong></li>
<li>生产者消费者问题</li>
<li>读者写者问题</li>
<li><ul>
<li>只考读者优先</li>
</ul>
</li>
<li>哲学家问题</li>
</ul>
</li>
<li>死锁</li>
<li><ul>
<li>死锁的定义</li>
<li><ul>
<li>考理解</li>
</ul>
</li>
<li>死锁产生的条件</li>
<li><ul>
<li>四个3+1</li>
</ul>
</li>
<li>应对死锁的方法</li>
<li><ul>
<li>各种思路</li>
</ul>
</li>
<li>银行家算法和Coffman算法</li>
<li><ul>
<li>思想、区别等</li>
</ul>
</li>
<li>综合的策略</li>
<li><ul>
<li>书上没有</li>
<li>还有后面的那个书上也没有</li>
</ul>
</li>
</ul>
</li>
<li>Unix系统的并发机制</li>
<li><ul>
<li>通信方法有什么，控制方法有什么</li>
<li>信号Signal</li>
<li>中断Interrupt</li>
<li>管道Pipe</li>
<li>后面没啥了</li>
</ul>
</li>
<li>《这里漏了一些》</li>
</ul>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><ul>
<li>应对延迟的方法</li>
<li><ul>
<li>一共五条，分成五条写</li>
</ul>
</li>
<li>磁盘调度算法</li>
<li><ul>
<li>考试肯定比小测上的复杂</li>
</ul>
</li>
<li>RAID不考</li>
<li>文件的组织方式</li>
<li><ul>
<li>都是理解性的</li>
</ul>
</li>
<li>文件大小的计算</li>
<li><ul>
<li>在UNIX里面讲的</li>
</ul>
</li>
<li>UNIX索引节点很重要</li>
<li>流文件与系统操作</li>
<li><ul>
<li>pp.106附近有一个题目</li>
</ul>
</li>
<li>空闲文件存储块</li>
<li><ul>
<li>50叉树的那个</li>
<li>作业题里面有，是个重点</li>
</ul>
</li>
<li>还有下推栈</li>
<li>Ext、F2FS<ul>
<li>这都不考</li>
</ul>
</li>
<li>SSD的文件系统</li>
<li><ul>
<li>有理解性的题目，在ppt150-160之间</li>
</ul>
</li>
</ul>
<h2 id="设备管理"><a href="#设备管理" class="headerlink" title="设备管理"></a>设备管理</h2><ul>
<li>这里没有大型的题目</li>
</ul>
<p>简答题<br>也是三大块都有<br>三个大应用题</p>
<ul>
<li>内存</li>
<li>进程</li>
<li>文件系统和设备</li>
<li><ul>
<li>绝对不会是出现在小测里的那么简单</li>
<li>肯定是要理解的</li>
</ul>
</li>
</ul>
<p>更正：磁盘的最外道为0道，最内道为高编码。如果期末考试没有说清楚是向编码高的方向移动，还是反方向，就举手问。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/06/09/%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BE%8E%E5%9B%BD%E5%9C%A85G%E4%BA%A7%E4%B8%9A%E5%8C%96%E5%BA%94%E7%94%A8%E4%B8%8A%E8%90%BD%E5%90%8E%E4%BA%86%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/09/%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BE%8E%E5%9B%BD%E5%9C%A85G%E4%BA%A7%E4%B8%9A%E5%8C%96%E5%BA%94%E7%94%A8%E4%B8%8A%E8%90%BD%E5%90%8E%E4%BA%86%EF%BC%9F/" class="post-title-link" itemprop="url">为什么美国在5G产业化应用上落后了？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-09 13:21:20" itemprop="dateCreated datePublished" datetime="2019-06-09T13:21:20+08:00">2019-06-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文为政治经济学课程作业。</p>
</blockquote>
<h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>目前有一些组织认为美国的5G发展已经落后。美国是否在5G中落后，又为什么在5G产业化应用中落后。本文将从政治经济学的多个角度对这个问题进行讨论。<br>关键字：<strong>美国 5G 政治经济学</strong></p>
<h1 id="1-引言"><a href="#1-引言" class="headerlink" title="1 引言"></a>1 引言</h1><p>美国无线通信和互联网协会（CTIA）在2018年4月16日发布的一份报告《The Global Race to 5G》 [1]中表示，从5G的应用进程中，中国、韩国领先全球，美国仅为于第三名。在2019年4月2日香港《南华早报》的一篇新闻稿 [2]的标题叫做《How US went from telecoms leader to 5G also-ran without challenger to China’s Huawei》。为什么美国在5G产业化应用上落后了？下文将主要从政治经济学等多个角度进行分析。</p>
<h1 id="2-分析"><a href="#2-分析" class="headerlink" title="2 分析"></a>2 分析</h1><h2 id="2-1-美国在5G产业中的地位"><a href="#2-1-美国在5G产业中的地位" class="headerlink" title="2.1 美国在5G产业中的地位"></a>2.1 美国在5G产业中的地位</h2><p>现代计算机与通信技术建立和发展于第二次世界大战和美苏冷战时期。美国拥有世界上最强的教育科研实力，贝尔实验室是现代通信系统中诸多发明的诞生地。5G三大场景中的eMBB（增强型移动宽带）场景中华为主推的Polar极化码的诞生地也在美国贝尔实验室。</p>
<p>美国的科研强，但其产业化并不强。从5G关键专利来看，根据德国专利数据库公司IPlytics的数据 [3]，美国在5G关键专利中只有14%的份额，远低于中国34%的比例。从电信设备提供商来看，美国没有能和中国的华为、韩国的三星、芬兰的诺基亚和瑞典的爱立信竞争的电信设备提供商。从产业化应用来看，美国在5G产业已经落后了。</p>
<h2 id="2-2-美国电信产业的制度"><a href="#2-2-美国电信产业的制度" class="headerlink" title="2.2 美国电信产业的制度"></a>2.2 美国电信产业的制度</h2><p>电信企业性质。美国电信企业如AT&amp;T、Verizon、Sprint等都是自负盈亏的私有公司。私有公司的主要目的是追求利润，因此在用户多的城市能够覆盖较好的信号，而对于人烟稀少的荒野就信号很差。运营商们还是上市公司，美国电信运营商在4G建设中已经花费了大量的资金，研发5G所需的大量资金短时间带来的压力会让公司股价难看。因此运营商对于5G研发精力不足。</p>
<p>频谱划分制度。美国实行频谱拍卖制度。2017年美国600MHz频谱拍卖达到200亿美元，其中T-Mobile花费80亿美元夺标 [4]。美国联邦通信委员会FCC拍卖的用于5G的24GHz和28GHz频谱费用超过27亿美元。高昂的频谱成本给运营商带来极大的资金压力。</p>
<p>电信设备准入制度。美国政府禁止华为设备进入美国电信系统，而美国本土已经没有能够有竞争力生产5G设备的企业。因此美国运营商需要花更高的价格购买三星、诺基亚、爱立信的设备，选择面上较小，成本较大。运营商对于快速部署5G的激情不够。</p>
<p>从理性选择和自由主义政治经济学来看，保持现状而不是投入巨资部署5G是美国运营商理性的选择。</p>
<p>美国允许运营商自主决定使用的技术。各家运营商的技术路线并不完全一致，在研发上分歧较大，无法形成整体的合力。以现实主义政治经济学的“霸权稳定论”来看，缺乏市场上“霸主”将不利于进行合作。</p>
<h2 id="2-3-金融资本的全球扩张"><a href="#2-3-金融资本的全球扩张" class="headerlink" title="2.3 金融资本的全球扩张"></a>2.3 金融资本的全球扩张</h2><p>美国金融资本已经是美国最重要的政治集团之一。金融资本专注于金融游戏，投资、利息等等钱生钱的活动。金融资本在全球扩张，只想着资本增值，而不在意是否对本国有利。这样使得美国的制造业外流，本土制造商已经无法承担起5G设备制造的重任。本土的电信巨头AT&amp;T早年被拆分，朗讯和摩托罗拉被收购，思科专注于企业网络设备，高通只负责专利授权而不制造。缺乏电信设备制造商，美国5G的产业化落地就进展较慢。</p>
<p>美国的资本对外输出，投资到三星、诺基亚、爱立信等企业。从列宁等人的观点来看，美国的资本资助了美国的竞争对手，损害了美国的制造业，为自己赚取了大量利润。虽然跨国公司中有大量的美国资本投资，但其是否会对美国的发展起到积极作用却是一个问题。</p>
<h2 id="2-4-中国的领先"><a href="#2-4-中国的领先" class="headerlink" title="2.4 中国的领先"></a>2.4 中国的领先</h2><p>中国的世界工厂制造大国身份提供了5G产业化发展的广阔市场。中兴、华为等电信制造商，小米、华为等终端制造商都从市场中锻炼出来。</p>
<p>在科学技术发展中，中国经常强调“自主可控”。自主便是以国家为中心的政治经济学的诉求之一。中国是大国，大国要在经济政治军事上自主独立才行。现实主义和国家主义都强调实施积极的产业政策。中国政府也确实在5G研发和应用中推出了诸多鼓励、扶持性政策。三大运营商是国有企业，政府的推动让运营商投入巨额资金进行研发和产业化。</p>
<h1 id="3-结论"><a href="#3-结论" class="headerlink" title="3 结论"></a>3 结论</h1><p>从政治经济学角度来看，美国5G产业化落后是有很多原因的，特别是金融资本的全球扩张带来的制造业空心化，以及政府未提供足够的积极政策等原因。与此相反，中国的5G产业化进展很快，便是因为政治上的不同，带来的经济结果不同。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>[1] CTIA, “Race to 5G Report,” 16 4 2018. [联机]. Available: <a target="_blank" rel="noopener" href="https://www.ctia.org/news/race-to-5g-report">https://www.ctia.org/news/race-to-5g-report</a>. [访问日期: 8 6 2019].<br>[2] Z. Soo, “How US went from telecoms leader to 5G also-ran without challenger to China’s Huawei,” 2 4 2019. [联机]. Available: <a target="_blank" rel="noopener" href="https://www.scmp.com/tech/enterprises/article/3004325/how-us-went-telecoms-leader-5g-also-ran-without-challenger-chinas">https://www.scmp.com/tech/enterprises/article/3004325/how-us-went-telecoms-leader-5g-also-ran-without-challenger-chinas</a>. [访问日期: 8 6 2019].<br>[3] IPlytics, “Who is leading the 5g patent race?,” 2019. [联机]. Available: <a target="_blank" rel="noopener" href="https://www.iplytics.com/report/who-is-leading-the-5g-patent-race/">https://www.iplytics.com/report/who-is-leading-the-5g-patent-race/</a>. [访问日期: 8 6 2019].<br>[4] C. Gibbs, “<a target="_blank" rel="noopener" href="https://www.fiercewireless.com/wireless/t-mobile-dish-and-comcast-top-bidders-incentive-auction-while-verizon-looks,%E2%80%9D">https://www.fiercewireless.com/wireless/t-mobile-dish-and-comcast-top-bidders-incentive-auction-while-verizon-looks,”</a> 13 4 2017. [联机]. Available: <a target="_blank" rel="noopener" href="https://www.fiercewireless.com/wireless/t-mobile-dish-and-comcast-top-bidders-incentive-auction-while-verizon-looks">https://www.fiercewireless.com/wireless/t-mobile-dish-and-comcast-top-bidders-incentive-auction-while-verizon-looks</a>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/06/02/%E5%86%8D%E8%B0%88%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E8%AF%95%E9%AA%8C%E7%8F%AD%E4%B9%8B%E2%80%9C%E5%A4%9A%E4%B8%80%E6%AC%A1%E6%9C%BA%E4%BC%9A%E2%80%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/02/%E5%86%8D%E8%B0%88%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E8%AF%95%E9%AA%8C%E7%8F%AD%E4%B9%8B%E2%80%9C%E5%A4%9A%E4%B8%80%E6%AC%A1%E6%9C%BA%E4%BC%9A%E2%80%9D/" class="post-title-link" itemprop="url">再谈交大工科试验班之“多一次机会”</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-02 14:50:42" itemprop="dateCreated datePublished" datetime="2019-06-02T14:50:42+08:00">2019-06-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在上海交大工科平台（工科试验班）的网站中的常见问题栏目下有这样一段话：</p>
<blockquote>
<p>7.工科平台学生与一般专业学生相比，有何优势？<br>RE：主要体现在以下方面：<br>A.提前批录取：<strong>增加了一次填报交大的机会。</strong><br>B.优质师资：各门课程由广受学生欢迎的优秀师资开设。<br>C.国际标准：与国际工程人才培养质量标准衔接，部分专业已经筹备工程专业认证。<br>D.专业选择：提供两次专业选择机会。鼓励优秀学生选报、投身所热爱的专业。<br>E.交叉氛围：各工科专业同学一起编班住宿、学习生活，提供工科交叉融合的氛围。</p>
</blockquote>
<p>每到高考招生季的时候，招生组也会对考生说，提前批填交大，可以多一次机会上交大，没有什么损失。在在校生的讨论中，我们也经常会听到一种说法叫“如果没有工科试验班，我可能来不了交大”。</p>
<p>真的就是“如果没有工科试验班，我可能来不了交大”这样吗？</p>
<p>当我查阅2012-2018年一共7年上海交大在重庆招生情况之后，整理出了如下数据：</p>
<p><strong>上海交大在重庆招生情况（理工类）</strong></p>
<p>|年份|2012|2013|2014|2015|2016|2017|2018|<br>|:—:|:—:|:—:|:—:|:—:|:—:|:—:|:—:|:—:|<br>|提前批分数|-|-|640|677|681|669|672|<br>|提前批排名|-|-|422|409|331|263|452|<br>|本一批分数|653|641|654|688|692|679|686|<br>|本一批排名|348|361|151|128|114|113|112|</p>
<p>上海交大在重庆招生情况（理工类）<br>在工科试验班招生之前的2012年和2013年，交大录取名次在重庆市350名上下波动。而开始招工科试验班之后，本一批次的录取名次一下次冲到了重庆市120名左右。而这时提前批的录取名次则在300名上下波动。</p>
<p>考虑到交大在重庆理工类提前批只有工科试验班，因此提前批的分数就是工科试验班的分数。</p>
<p>再考虑到交大学校本身的进步和宣传的长进，分数线的上涨是正常的事情，因此我认为工科试验班的录取名次就等于试验班之前的原有本一批的排名。</p>
<p>再考虑到交大不可能凭空地多出来工科试验班的招生名额，因此试验班这部分的招生名额便是从原有的本一批次的名额中剥离出来的。</p>
<p>现在结论就很明显了，根本不存在什么“多一次机会”，从工科试验班进交大的学生，在没有工科试验班的情况下也是能上交大的。</p>
<p>我们将交大的将大量招生名额放到提前批，在本一批只留非常少的名额的行为叫做“超短裙招生”。在持续数年的超短裙招生的操作下，考生在报考之前已经接受了交大录取就是超高的本一批分数线这种“事实”。当他们发现提前批录取名次这么低的时候，就会被“没有工科试验班就来不了交大”这种言论包围。</p>
<p>那有人会说，反正都能进交大，“超短裙招生”有什么问题吗？反正对学校和考生是双赢。</p>
<p>我目前发现有一个问题，工科试验班剥夺了学生自由转专业的权利。</p>
<p>在工科平台转专业规定中，有如下说明：</p>
<blockquote>
<p>2.工科平台学生是否可以享受学校自主转专业？<br>RE：因工科平台学生提前批录取，故不参与全校学生在大一春季学期自主选专业环节。但是平台学生在平台内有两次选择专业机会，第一次是大一秋季学期进行的专业预选；第二次是大二秋季学期专业分流，30%同学可以享受二次调整专业。</p>
</blockquote>
<blockquote>
<p>3.入校后非工科平台学生是否有机会转入工科平台？<br>RE：工科平台的培养是相对封闭的，所以不接受过程中的转入和转出。<br>工科平台（工科试验班）的学生，转专业只能在参与建设的六个学院的19个专业中选择，而不能选择人文、外语、经管、法学、数学、物理、化学、生物、医学等其他学院其他专业。</p>
</blockquote>
<p>至于课程设置这种大家吐槽较多的东西，就见仁见智了，在此不加评论。</p>
<p>因此，我的结论是，工科平台并不是学校的“恩赐”，反而是对学生权利的剥夺，它只有利于提高学校的分数线。</p>
<p>文中提及的数据出处：<br><a target="_blank" rel="noopener" href="http://zsb.sjtu.edu.cn/web/jdzsb/3810062.htm">交大招生办–报考指南–历年分数</a><br><a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/1c756bf5c0c708a1284ac850ad02de80d4d80664.html">2012-2016重庆市高考理科含加分一分段表</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/06/01/%E4%B8%8A%E6%B5%B7%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E5%B9%B3%E5%8F%B0%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E6%8A%AB%E9%9C%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/01/%E4%B8%8A%E6%B5%B7%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E5%B9%B3%E5%8F%B0%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E6%8A%AB%E9%9C%B2/" class="post-title-link" itemprop="url">上海交大工科平台部分数据披露</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-01 15:02:10" itemprop="dateCreated datePublished" datetime="2019-06-01T15:02:10+08:00">2019-06-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>2019年，上海交通大学工科平台（工科试验班）建设进入第5个年头。</p>
<p>2014级开始招第一届工科试验班，共有8个学院23个专业。<br>2015级软件工程、化学工程与工艺和核工程与核技术退出试验班专业名录。<br>2016级取消招生时的面试，生物工程退出试验班专业目录。<br>2017级软件工程重回试验班，建筑学纳入试验班高考招生，在上海将除特定试点班外的工科全部纳入工科试验班。<br>2018级工科大平台推广到全校工科专业，专业预选后试验班被打散。</p>
<p>当我查阅《上海交通大学年鉴》的时候，翻阅到了一些试验班的新闻片段。现张贴如下：</p>
<blockquote>
<p>……依托试点学院探索工科试验班类提前批招生新模式。……工科大平台面向全国12个省市招收了407名（含贫困专项定向招生21人）学生。共有八个学院的23个工科专业参与平台建设，<strong>专业预选前三志愿满足率达到98%。</strong>——《上海交通大学年鉴2015》</p>
</blockquote>
<blockquote>
<p>继续实施基于试点学院改革的工科大类提前批招生工作。在部分省（市）高考本科第一批次前投放理科计划，以“工科试验班类”为代码，采用综合评价方式招生，纳入到学校“工科创新人才培养平台”进行培养，为对大工程学科有强烈兴趣、具有创新和发展潜质的学生提供更多进入上海交大的机会。……2014级工科平台专业分流进展顺利，<strong>共有63名学生实现了二次专业选择</strong>。2015级工科平台专业预选**前三志愿满足率达到了97.1%**。——《上海交通大学年鉴2016》</p>
</blockquote>
<blockquote>
<p>工科平台第一届学生已圆满结束平台学习期，2015级工科平台专业分流进展顺利，共有<strong>56名学生实现了二次专业选择，成功转专业比例达61%<strong>。在前两年运行成效显著的基础上，全校共有六个学院的19个专业参与工科平台建设，面向14个省市招收了735名学生，2016级工科平台专业预选</strong>前三志愿满足率达到了97.1%。</strong>——《上海交通大学年鉴2017》</p>
</blockquote>
<blockquote>
<p>2017级工科平台和生环平台专业分流进展顺利，2017级工科平台专业预选**前三志愿满足率达到98.64%<strong>。生环平台达到88.84%，</strong>二次分流成功转专业比例分别为70%和63%**。——《上海交通大学年鉴2018》</p>
</blockquote>
<p>将上述数据和其他公开数据整理之后，成表如下：</p>
<img src="/2019/06/01/%E4%B8%8A%E6%B5%B7%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E5%B9%B3%E5%8F%B0%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E6%8A%AB%E9%9C%B2/%E5%B7%A5%E8%AF%95%E6%83%85%E5%86%B5.jpg" class="" title="工试情况">

<p>这里需要解释一下“前三志愿满足率”。工科平台在进校第一个月结束的时候进行专业预选（注意这里不叫专业分流），需要按照顺序填写六个学院的志愿。按照2018级各学院预选人数表，假设所有人的前三志愿都是“电-机-船”（顺序无关），那么前三志愿满足率就有(524+268+150)&#x2F;1122&#x3D;83.96%。</p>
<img src="/2019/06/01/%E4%B8%8A%E6%B5%B7%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E5%B9%B3%E5%8F%B0%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E6%8A%AB%E9%9C%B2/18%E5%B7%A5%E8%AF%95%E9%A2%84%E9%80%89%E5%90%8D%E9%A2%9D.jpg" class="" title="18工试预选名额">

<p>关于转专业，2016级及以前的资料可以参见我的知乎回答。<br><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/66230648/answer/239988540">2017上海交通大学工科大平台大一新生面临分流，学长学姐学的是什么专业，有什么建议吗？</a></p>
<p>2017级转专业结果可以参见下面的链接。<br><a href="https://link.zhihu.com/?target=http://ep.sjtu.edu.cn/?p=1129">【专业分流】上海交通大学关于2017级工科平台专业分流结果公示的通知 - 上海交通大学 工科平台</a></p>
<p>2017级转入转出表</p>
<img src="/2019/06/01/%E4%B8%8A%E6%B5%B7%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E5%B9%B3%E5%8F%B0%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E6%8A%AB%E9%9C%B2/2017%E7%BA%A7%E8%BD%AC%E5%85%A5%E8%BD%AC%E5%87%BA%E8%A1%A8.jpg" class="" title="2017级转入转出表">
<p>2017级转入专业录取名次区间表（不对数据真实性负责）</p>
<img src="/2019/06/01/%E4%B8%8A%E6%B5%B7%E4%BA%A4%E5%A4%A7%E5%B7%A5%E7%A7%91%E5%B9%B3%E5%8F%B0%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E6%8A%AB%E9%9C%B2/2017%E7%BA%A7%E8%BD%AC%E5%85%A5%E4%B8%93%E4%B8%9A%E5%BD%95%E5%8F%96%E5%90%8D%E6%AC%A1%E5%8C%BA%E9%97%B4%E8%A1%A8.jpg" class="" title="2017级转入专业录取名次区间表">

<p>关于工科平台和非工科平台的对比，可以参见《上海交通大学2017-2018学年本科教学质量报告》。</p>
<blockquote>
<p>2018年，工科平台首届毕业生毕业，学校对首届平台学生进行了学业跟踪调查，结果显示，①平台学生在学习成绩、知识层面上，整体水平和末端水平都较面上学生优异。②平台学生7种学习能力增长值均较面上工科学生大，特别是平台学生在工程设计能力、工程实践能力、集成创新能力的增长显著。受访学生中具有创新意识的平台学生比例明显高于面上学生，约为后者的三倍。③平台学生在5个方面学习素养的同期增长均优于面上学生。④学生普遍反映，通过平台的学习，具备了广阔的知识面，为后续专业学习、深造及就业提供了良好的知识储备；平台科学的课程体系设置，增强了学生的学习能力，调动了学生的学习主动性；平台的培养模式，扩大了学生的交际圈，不同专业同学可进行知识互补，学学相长。⑤工科平台学生平均GPA高于面上学生；出国深造和在国内深造的比例接近全部工科平台学生的三分之二，略高于非工科平台学生，学生培养了专业兴趣，保持了浓厚的继续深造势头。</p>
</blockquote>
<p>本文提及资料来源：<br><a href="https://link.zhihu.com/?target=http://gk.sjtu.edu.cn/Data/View/1382">上海交通大学2017-2018学年本科教学质量报告 - 本科教学质量报告 - 上海交通大学信息公开网</a><br><a href="https://link.zhihu.com/?target=http://navi.cnki.net/KNavi/YearbookDetail?pcode=CYFD&pykm=YSHJD&bh=">上海交通大学年鉴</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/05/26/%E5%AD%A6%E4%BB%A3%E4%BC%9A%E4%B8%AD%E7%9A%84%E6%94%BF%E6%B2%BB%E7%BB%8F%E6%B5%8E%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/26/%E5%AD%A6%E4%BB%A3%E4%BC%9A%E4%B8%AD%E7%9A%84%E6%94%BF%E6%B2%BB%E7%BB%8F%E6%B5%8E%E5%AD%A6/" class="post-title-link" itemprop="url">学代会中的政治经济学</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-26 13:20:20" itemprop="dateCreated datePublished" datetime="2019-05-26T13:20:20+08:00">2019-05-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文为政治经济学课程作业。</p>
</blockquote>
<p>2018年底，上海交通大学电子信息与电气工程学院召开第九次学生代表大会。</p>
<p>根据学院介绍，学代会是是学生维护权益的重要方式，也是学院和同学交流意见的重要渠道。从电院学生中选择一定的学生代表参与会议，代表应该是很光荣和有话语权的。会前学院学生会在各班通知选出代表参加学代会，然而根据实际情况来看，积极报名参加的学生寥寥无几。学生会事先考虑到了同学们的积极性不高，因此承诺参与学代会可以计入综合测评的素质拓展分数。按照电院综合测评条例，参与学代会可以获得1学分满分的素拓。在这种奖励下，各班凑齐了参与学代会的学生代表。</p>
<p>在学代会现场，第八届学生会主席做第八届学生会工作报告和第九届学代会筹备工作报告。按照事后的新闻稿的说法是“经代表审议后一致通过”，而现场实际上是氛围沉闷。工作人员请代表审阅并是否提出异议，少有人仔细聆听并无人提出异议。而后的主席团选举，各位候选人发布竞选演讲并展示“施政纲领”。各自的“施政纲领”大同小异，并无本质上的区别，因此选举中并未有压倒性的一边倒情况，各位候选人的得票较为平均。</p>
<p>从理性选择角度来分析，参与学代会的成本很大，而收益却很小。参加学代会意味着需要在临近期末的时候花掉周末中的一整个白天。对于交大学生来说，时间是稀缺的资源，一整天的时间成本确实很大。学代会还要求着正装出席，这对代表们又是一件增加成本的事情。而学代会的受益只有所谓的选举主席团和1分素拓。按照电院的综合测评条例来看，1分素拓分实在是有限。而所谓的选举主席团，如果真的要了解候选人的信息，代表们需要付出很大的代价。根据理性选择，参与学代会的成本大而受益小，因此积极性不高。</p>
<p>更加核心的问题在于，学代会选谁上主席团，对于学生而言并无本质区别。从表象来看，各位候选人的“施政纲领”大同小异，无本质区别。从候选人角度来看，按照理性选择观点，候选人的“纲领”不能过于激进，需要靠近中间代表。因此各自的差异就非常小，代表们选谁都没什么区别。从实质来看，学生会的权力实在是太小，并不能在学生事务上做主。各项和学生有关的事项均是由学院负责老师和领导决定，学生会只能传达上面的政策和反馈下面的意见，更多时候并不会进行反馈。学生会的日常就是主持承办各种文体活动，这和学生的利益并没有太大关系。所以选举主席团并没有能给学生带来很大的收益。</p>
<p>综上所述，按照理性选择分析学代会的成本和收益，就能够解释学代会中的积极性不高的现象。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/03/06/%E5%A4%A7%E4%B8%89%E4%B8%8A%E5%AD%A6%E6%9C%9F%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/06/%E5%A4%A7%E4%B8%89%E4%B8%8A%E5%AD%A6%E6%9C%9F%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">大三上学期总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-06 13:18:40" itemprop="dateCreated datePublished" datetime="2019-03-06T13:18:40+08:00">2019-03-06</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>时光飞逝，转眼已是2019年。在交大已经生活学习了近3年的我，已经开始面对未来的选择了。大三上这一学期经历了很多事情，做了许多工作，也有许多不足的反思，值得细细总结。新的一学期已经开始，面对未来的发展方向，我需要有一些计划，并为之付出行动了。</p>
<p>整个学期，对于必修课而言，脱离了基础课的学习，进入了专业课的学习，我需要适应各课程老师的风格与节奏。对于某些课程，我很好地跟随老师的教学，最终取得了高分。而对于另外一些课程，自己没能妥善安排，加上长期存在的“数学恐惧症”，没能拿到高分。除此之外，凭借着选课系统对于高年级的优先级，在必修课以外，我相较于前几学期，更多地按照兴趣选择了一些课程。这些选修课对我一些技能和视野的开阔还是取得了比较好的效果。</p>
<p>在其他方面，我比较喜欢数学建模比赛，因此积极地参加了国赛、美赛，都有精心准备并参与其中。另外，由于我比较喜欢水群，经常活跃在新生群里面，我担任了生活园区C++学业辅导员。别人看来或许会很费时间，然而对我而言，我觉得这种事情却能给我带来存在感和满足感。</p>
<p>对于课程学业而言，或许我是一直以来就存在着只盯着平均分看，对自己要求不高，期望值较低这种问题，因此最终的成绩反映出来也就仅仅对得上这种低要求。回想大一大二的时候，对待课程基本上就是完成作业，然后期末前简单复习一下就完事。这种状态一直持续下来，每学期面对相比于上学期都在增加的学积分沾沾自喜，至于当我面对排名的时候，却发现虽然大家都在进步，但是同学们的进步幅度比我大很多。</p>
<p>在新的学期里面，首先我要做的事情是继续提高课业成绩，圆满完成这学期的必修课任务。这方面主要需要合理安排时间，紧凑而不失节奏地安排好课程。另外还要在课余时间进行项目的准备，自我探索的实践。而且这学期前半学期的时间相当充裕，而后半学期的时间比较紧张。对于我来说，常常会在时间宽松充裕的时候白白浪费时间。因此，不浪费时间也是一个巨大的挑战。</p>
<p>我希望，当我在本学期结束的时候，各方面都能达到自己设定的目标，各项决定都不留下遗憾。这个希望听起来简单，但是实施起来却不是那么容易。不管怎么样，我还是拭目以待吧。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.dujiajun.site/2019/01/11/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AE%9E%E8%B7%B51%E6%8A%A5%E5%91%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="杜某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一无是处杜某某">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 一无是处杜某某">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/01/11/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AE%9E%E8%B7%B51%E6%8A%A5%E5%91%8A/" class="post-title-link" itemprop="url">编译原理课程实践1报告</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-11 14:12:33" itemprop="dateCreated datePublished" datetime="2019-01-11T14:12:33+08:00">2019-01-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、环境"><a href="#一、环境" class="headerlink" title="一、环境"></a>一、环境</h2><table>
<thead>
<tr>
<th align="center">项目</th>
<th align="center">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center">系统</td>
<td align="center">Ubuntu 18.04 (Windows Subsystem for Linux), Windows 10 Home, version 1809</td>
</tr>
<tr>
<td align="center">GCC</td>
<td align="center">Ubuntu 7.3.0-27ubuntu1~18.04</td>
</tr>
<tr>
<td align="center">Python</td>
<td align="center">Python 2.7.15 [GCC 7.3.0] :: Anaconda, Inc. on linux2</td>
</tr>
<tr>
<td align="center">flex</td>
<td align="center">flex 2.6.4</td>
</tr>
</tbody></table>
<h2 id="二、功能实现"><a href="#二、功能实现" class="headerlink" title="二、功能实现"></a>二、功能实现</h2><h3 id="1、指数转换"><a href="#1、指数转换" class="headerlink" title="1、指数转换"></a>1、指数转换</h3><p>首先，分析Python中指数的可能形式。</p>
<p>由于题目中的Python 版本为2.7，通过查询Python 2.7相关文档（ <a target="_blank" rel="noopener" href="https://docs.python.org/2.7/reference/lexical_analysis.html">https://docs.python.org/2.7/reference/lexical_analysis.html</a> ），获得浮点数的相关词法定义。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">floatnumber   ::=  pointfloat | exponentfloat</span><br><span class="line">pointfloat    ::=  [intpart] fraction | intpart &quot;.&quot;</span><br><span class="line">exponentfloat ::=  (intpart | pointfloat) exponent</span><br><span class="line">intpart       ::=  digit+</span><br><span class="line">fraction      ::=  &quot;.&quot; digit+</span><br><span class="line">exponent      ::=  (&quot;e&quot; | &quot;E&quot;) [&quot;+&quot; | &quot;-&quot;] digit+</span><br></pre></td></tr></table></figure>

<p>如下为一些浮点数的形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.14    10.    .001    1e100    3.14e-10    0e0</span><br></pre></td></tr></table></figure>

<p>可以看出，Python中指数的形式可以描述为：<code>(整数部分|浮点数)(e|E)[-+]?整数部分</code>。其中，整数部分允许前导<code>0</code>，浮点数允许省略<code>0.X</code>开头的<code>0</code>和<code>	X.0</code>结尾的<code>0</code>，<code>e</code>可以为大写也可以为小写，<code>e</code>之后可以或者省略紧跟<code>+</code>和<code>-</code>表示指数次数的正负，而后的次数只能为整数，整个数字中间不存在空格。</p>
<p>下面给出单个数字、整数部分、浮点数和指数在<code>LEX</code>中的规则：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">digit [0-9]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intpart &#123;digit&#125;+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pointfloat (&#123;intpart&#125;?[.]&#123;intpart&#125;)|(&#123;intpart&#125;[.])</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exponentfloat (&#123;intpart&#125;|&#123;pointfloat&#125;)(e|E)([-+]?)&#123;intpart&#125;</span><br></pre></td></tr></table></figure>

<p>当匹配到<code>exponentfloat</code>时，将其转换为小数并写入输出流。下面给出匹配到<code>exponentfloat</code>时的程序操作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;exponentfloat&#125; &#123;</span><br><span class="line">    <span class="type">int</span> precision = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> decimal = str2double(yytext, <span class="number">0</span>, yyleng, &amp;precision);</span><br><span class="line">    printByPrecision(decimal, precision);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>str2double</code>是把字符串中<code>st</code>到<code>ed</code>范围内的子串转换成浮点数并返回其小数位数的函数。函数原型如下，具体实现见附录：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">str2double</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">int</span> st, <span class="type">int</span> ed, <span class="type">int</span> * precision)</span>;</span><br></pre></td></tr></table></figure>

<p><code>printByPrecision</code>是给出浮点数及其精度，去掉小数点后多余的0后输出的函数，最少有一位小数。函数定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">printByPrecision</span><span class="params">(<span class="type">double</span> x, <span class="type">int</span> precision)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">sprintf</span>(buffer, <span class="string">&quot;%.*lf&quot;</span>, precision, x);</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(buffer);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (buffer[i] == <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            precision--;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (precision == <span class="number">0</span>)</span><br><span class="line">        precision++;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.*lf&quot;</span>, precision, x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将程序作用到题目所给的<code>test.py</code>，执行结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; flex flex.l</span><br><span class="line">&gt; gcc lex.yy.c -lfl</span><br><span class="line">&gt; ./a.out &lt;test.py &gt;result.py</span><br><span class="line">&gt; python ./test.py</span><br><span class="line">10000000000.0 0.05 579 3399.95 45.73</span><br><span class="line">&gt; python ./result.py</span><br><span class="line">10000000000.0 0.05 579 3399.95 45.73</span><br></pre></td></tr></table></figure>

<p><code>result.py</code>内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python </span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">main</span>():</span><br><span class="line">    a = <span class="number">10000000000.0</span></span><br><span class="line">    b = <span class="number">0.05</span></span><br><span class="line">    c = <span class="number">123</span>+<span class="number">456</span></span><br><span class="line">    d = <span class="number">3400.0</span>-<span class="number">0.05</span></span><br><span class="line">    e = <span class="number">34</span>+<span class="number">800.0</span>+<span class="number">0.73</span>-<span class="number">789</span></span><br><span class="line">    <span class="built_in">print</span> a,b,c,d,e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>   __name__  ==  <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()  </span><br></pre></td></tr></table></figure>

<h3 id="2、加减法计算"><a href="#2、加减法计算" class="headerlink" title="2、加减法计算"></a>2、加减法计算</h3><p>在上一问的基础上，只需要识别加减表达式即可。在这里我考虑了变量与常量混合的情况，并且忽略<code>+-</code>连续出现而没有运算数的情况。</p>
<p>在只考虑十进制的情况下，表达式可以用描述为，以<code>-+</code>符号或者<code>-+</code>符号连接上数字或者变量开头，随后紧跟0个或者若干个由<code>-+</code>符号连接上数字或者变量的算式。在<code>LEX</code>中的规则可以定义为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decimalinteger ([1-9][0-9]*)|0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numeric &#123;decimalinteger&#125;|&#123;pointfloat&#125;|&#123;exponentfloat&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alphabet [a-zA-Z]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">variable (&#123;alphabet&#125;|_)+(&#123;numeric&#125;|&#123;alphabet&#125;|_)*</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression [-+]?(&#123;numeric&#125;|&#123;variable&#125;)([-+](&#123;numeric&#125;|&#123;variable&#125;))*</span><br></pre></td></tr></table></figure>

<p>当匹配到<code>expression</code>时，需要将其计算出结果，并写入到输出流中。考虑到实际代码中整数和浮点数的内存占用不同，这里需要将整数与浮点数区别开考虑。表达式参与计算的值如果全部为整数，得到的结果也应该是整数，如果有浮点数参与运算，那么结果就应该是浮点数。对于整数，这里假设其范围在<code>-2147483648~2147483647</code>之间，即C语言中<code>int</code>类型的范围。</p>
<p>下面给出匹配到<code>expression</code>时的程序操作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&#123;expression&#125; &#123;</span><br><span class="line">    <span class="type">int</span> st = <span class="number">0</span>, flag = <span class="number">1</span>; <span class="comment">//st：当前数字的在字符串中开始的位置，flag：需要加还是减</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hasVar = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//判断是否有变量</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((yytext[i] == <span class="string">&#x27;+&#x27;</span> || yytext[i] == <span class="string">&#x27;-&#x27;</span>) &amp;&amp; !(yytext[i + <span class="number">1</span>] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; yytext[i + <span class="number">1</span>] &lt;= <span class="string">&#x27;9&#x27;</span> || yytext[i + <span class="number">1</span>] == <span class="string">&#x27;.&#x27;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            ECHO;</span><br><span class="line">            hasVar = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!hasVar)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> isfloat = <span class="number">0</span>; <span class="comment">//是否作为浮点数进行计算</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (yytext[i] == <span class="string">&#x27;.&#x27;</span> || yytext[i] == <span class="string">&#x27;e&#x27;</span> || yytext[i] == <span class="string">&#x27;E&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                isfloat = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isfloat)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> maxprecision = <span class="number">0</span>, precision = <span class="number">0</span>;</span><br><span class="line">            <span class="type">double</span> sum = <span class="number">0</span>; <span class="comment">//运算结果</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//遇到+-号就可以判断数字的起止位置</span></span><br><span class="line">                <span class="keyword">if</span> (yytext[i] == <span class="string">&#x27;+&#x27;</span> || yytext[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//如果是第一个符号，那么不进行计算，只更改符号</span></span><br><span class="line">                    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        flag = (yytext[i] == <span class="string">&#x27;+&#x27;</span>) ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">                        st = i + <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//如果前面不是E，那么进行计算，如果是E的话，认为是数字的一部分，交给str2double处理</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (yytext[i - <span class="number">1</span>] != <span class="string">&#x27;E&#x27;</span> &amp;&amp; yytext[i - <span class="number">1</span>] != <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">double</span> tmp = str2double(yytext, st, i, &amp;precision);</span><br><span class="line">                        <span class="keyword">if</span> (precision &gt; maxprecision)</span><br><span class="line">                            maxprecision = precision;</span><br><span class="line">                        sum += tmp * flag;</span><br><span class="line">                        flag = (yytext[i] == <span class="string">&#x27;+&#x27;</span>) ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">                        st = i + <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//遇到匹配末尾</span></span><br><span class="line">                <span class="keyword">if</span> (i == yyleng - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">double</span> tmp = str2double(yytext, st, yyleng, &amp;precision);</span><br><span class="line">                    <span class="keyword">if</span> (precision &gt; maxprecision)</span><br><span class="line">                        maxprecision = precision;</span><br><span class="line">                    sum += tmp * flag;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            printByPrecision(sum, maxprecision);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>; <span class="comment">//运算结果</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//遇到+-号就可以判断数字的起止位置</span></span><br><span class="line">                <span class="keyword">if</span> (yytext[i] == <span class="string">&#x27;+&#x27;</span> || yytext[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//如果不是第一个符号，进行计算</span></span><br><span class="line">                    <span class="keyword">if</span> (i != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">int</span> tmp = str2int(yytext, st, i);</span><br><span class="line">                        sum += tmp * flag;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//整数情况下不存在E</span></span><br><span class="line">                    flag = (yytext[i] == <span class="string">&#x27;+&#x27;</span>) ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">                    st = i + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//遇到匹配末尾了</span></span><br><span class="line">                <span class="keyword">if</span> (i == yyleng - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> tmp = str2int(yytext, st, yyleng);</span><br><span class="line">                    sum += tmp * flag;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, sum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;             </span><br></pre></td></tr></table></figure>

<p><code>str2int</code>是把字符串中<code>st</code>到<code>ed</code>范围内的子串转换成整数的函数。函数原型如下，具体实现见附录：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">str2int</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">int</span> st, <span class="type">int</span> ed)</span>;</span><br></pre></td></tr></table></figure>

<p>将程序作用到题目所给的<code>test.py</code>，执行结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; flex flex.l</span><br><span class="line">&gt; gcc lex.yy.c -lfl</span><br><span class="line">&gt; ./a.out &lt;test.py &gt;result.py</span><br><span class="line">&gt; python ./test.py</span><br><span class="line">10000000000.0 0.05 579 3399.95 45.73</span><br><span class="line">&gt; python ./result.py</span><br><span class="line">10000000000.0 0.05 579 3399.95 45.73</span><br></pre></td></tr></table></figure>

<p><code>result.py</code>内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python </span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">main</span>():</span><br><span class="line">    a = <span class="number">10000000000.0</span></span><br><span class="line">    b = <span class="number">0.05</span></span><br><span class="line">    c = <span class="number">579</span></span><br><span class="line">    d = <span class="number">3399.95</span></span><br><span class="line">    e = <span class="number">45.73</span></span><br><span class="line">    <span class="built_in">print</span> a,b,c,d,e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>   __name__  ==  <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()  </span><br></pre></td></tr></table></figure>

<h3 id="3、更多case"><a href="#3、更多case" class="headerlink" title="3、更多case"></a>3、更多case</h3><p>下面是一个考虑了更多情况的测试文件<code>test2.py</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python </span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">main</span>():</span><br><span class="line">    a = <span class="number">1e+2</span>+<span class="number">3</span></span><br><span class="line">    b = <span class="number">.53e3</span>+<span class="number">100.</span></span><br><span class="line">    c = <span class="number">1</span>+<span class="number">2</span>+a</span><br><span class="line">    d = +<span class="number">1</span>+<span class="number">2</span>+<span class="number">3</span>-<span class="number">4</span>-<span class="number">2e-1</span></span><br><span class="line">    e = a+<span class="number">3</span>+b+<span class="number">1e5</span></span><br><span class="line">    <span class="built_in">print</span> <span class="number">1</span>+<span class="number">5</span></span><br><span class="line">    <span class="built_in">print</span> a,b,c,d,e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>   __name__  ==  <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()  </span><br></pre></td></tr></table></figure>

<p>终端中执行结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; flex flex.l</span><br><span class="line">&gt; gcc lex.yy.c -lfl</span><br><span class="line">&gt; ./a.out &lt;test2.py &gt;result2.py</span><br><span class="line">&gt; python ./test2.py</span><br><span class="line">6</span><br><span class="line">103.0 630.0 106.0 1.8 100736.0</span><br><span class="line">&gt; python ./result2.py</span><br><span class="line">6</span><br><span class="line">103.0 630.0 106.0 1.8 100736.0</span><br></pre></td></tr></table></figure>

<p><code>result2.py</code>内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python </span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">main</span>():</span><br><span class="line">    a = <span class="number">103.0</span></span><br><span class="line">    b = <span class="number">630.0</span></span><br><span class="line">    c = <span class="number">1</span>+<span class="number">2</span>+a</span><br><span class="line">    d = <span class="number">1.8</span></span><br><span class="line">    e = a+<span class="number">3</span>+b+<span class="number">1e5</span></span><br><span class="line">    <span class="built_in">print</span> <span class="number">6</span></span><br><span class="line">    <span class="built_in">print</span> a,b,c,d,e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>   __name__  ==  <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()  </span><br></pre></td></tr></table></figure>

<h2 id="三、感想"><a href="#三、感想" class="headerlink" title="三、感想"></a>三、感想</h2><p>本次大作业利用<code>LEX</code>进行代码预处理。在实际操作中我先是简单的执行了书上给出的样例，观察了输出和匹配串的行为，然后再设计题目要求的功能。在处理浮点数时，最开始考虑的是在Python中进行尝试，然后总结出指数的正规式，基于自己总结的正规式完成了整个功能。后来在和同学交流中发现Python官网的文档里面有写指数的词法定义，于是对规则进行了完善。</p>
<p>在我的代码中，我对输入做了一定的假设。比如，假设输入的整数只能是C语言<code>int</code>类型的范围，不支持输入<code>l</code>表示长整型等。在输出的时候，由于<code>double</code>的精度问题，输出的小数默认都是6位，而题目样例中给的输出参考是1位或者2位的自适应长度。为了解决这个问题，特意在提取数值的时候求出浮点数的小数位数，并在表达式中取最大的一个精度，然后利用这个精度将求出的结果重新转换为字符串，最后删去末尾多余的0即可。</p>
<h2 id="附：完整的flex-l代码"><a href="#附：完整的flex-l代码" class="headerlink" title="附：完整的flex.l代码"></a>附：完整的flex.l代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">str2int</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">int</span> st, <span class="type">int</span> ed)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> base = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = st; i &lt; ed; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        num = num * base + str[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="title function_">str2double</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">int</span> st, <span class="type">int</span> ed, <span class="type">int</span> *precision)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> isfloat = <span class="number">0</span>; <span class="comment">//是否作为浮点数进行计算</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = st; i &lt; ed; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (str[i] == <span class="string">&#x27;.&#x27;</span> || str[i] == <span class="string">&#x27;e&#x27;</span> || str[i] == <span class="string">&#x27;E&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            isfloat = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isfloat)</span><br><span class="line">    &#123;</span><br><span class="line">        *precision = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> str2int(str, st, ed);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> num1 = <span class="number">0</span>;          <span class="comment">//e之前的数值</span></span><br><span class="line">    <span class="type">int</span> num2 = <span class="number">0</span>;             <span class="comment">//e之后的数值</span></span><br><span class="line">    <span class="type">int</span> flag1 = <span class="number">0</span>, flag2 = <span class="number">0</span>; <span class="comment">//flag1：是否在小数点后，flag2：是否在e之后</span></span><br><span class="line">    <span class="type">double</span> e = <span class="number">1</span>;             <span class="comment">//小数点之后的权重</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = st; i &lt; ed; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (str[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; str[i] &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!flag1 &amp;&amp; !flag2) <span class="comment">//e以前，小数点前</span></span><br><span class="line">                num1 = num1 * <span class="number">10</span> + (str[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (flag1 &amp;&amp; !flag2) <span class="comment">//e以前，小数点后</span></span><br><span class="line">            &#123;</span><br><span class="line">                e = e / <span class="number">10.0</span>;</span><br><span class="line">                (*precision)++;</span><br><span class="line">                num1 = num1 + (str[i] - <span class="string">&#x27;0&#x27;</span>) * e;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (flag2) <span class="comment">//e以后</span></span><br><span class="line">                num2 = num2 * <span class="number">10</span> + (str[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (str[i] == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            flag1 = <span class="number">1</span>;</span><br><span class="line">            (*precision)++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (str[i] == <span class="string">&#x27;e&#x27;</span> || str[i] == <span class="string">&#x27;E&#x27;</span>)</span><br><span class="line">            flag2 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (str[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            flag2 = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (e != <span class="number">1</span>)</span><br><span class="line">        (*precision)--;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> k = <span class="number">1</span>;   <span class="comment">//10的num2次方</span></span><br><span class="line">    <span class="keyword">if</span> (flag2 == <span class="number">1</span>) <span class="comment">//e之后是正幂次</span></span><br><span class="line">    &#123;</span><br><span class="line">        (*precision) -= num2;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num2; i++)</span><br><span class="line">            k = k * <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (flag2 == <span class="number">2</span>) <span class="comment">//e之后是负幂次</span></span><br><span class="line">    &#123;</span><br><span class="line">        (*precision) += num2;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num2; i++)</span><br><span class="line">            k = k / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (*precision &lt;= <span class="number">0</span>)</span><br><span class="line">        *precision = <span class="number">1</span>;</span><br><span class="line">    num1 = num1 * k;</span><br><span class="line">    <span class="keyword">return</span> num1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printByPrecision</span><span class="params">(<span class="type">double</span> x, <span class="type">int</span> precision)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">sprintf</span>(buffer, <span class="string">&quot;%.*lf&quot;</span>, precision, x);</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(buffer);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (buffer[i] == <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            precision--;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (precision == <span class="number">0</span>)</span><br><span class="line">        precision++;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.*lf&quot;</span>, precision, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%&#125;</span><br><span class="line">digit [<span class="number">0</span><span class="number">-9</span>]</span><br><span class="line">intpart &#123;digit&#125;+</span><br><span class="line">pointfloat (&#123;intpart&#125;?[.]&#123;intpart&#125;)|(&#123;intpart&#125;[.])</span><br><span class="line">exponentfloat (&#123;intpart&#125;|&#123;pointfloat&#125;)(e|E)[-+]?&#123;intpart&#125;</span><br><span class="line">decimalinteger ([<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*)|<span class="number">0</span></span><br><span class="line">numeric &#123;decimalinteger&#125;|&#123;pointfloat&#125;|&#123;exponentfloat&#125;</span><br><span class="line">alphabet [a-zA-Z]</span><br><span class="line">variable (&#123;alphabet&#125;|_)+(&#123;numeric&#125;|&#123;alphabet&#125;|_)*</span><br><span class="line">expression [-+]?(&#123;numeric&#125;|&#123;variable&#125;)([-+](&#123;numeric&#125;|&#123;variable&#125;))*</span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">&#123;exponentfloat&#125; &#123;</span><br><span class="line">    <span class="type">int</span> precision = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> decimal = str2double(yytext, <span class="number">0</span>, yyleng, &amp;precision);</span><br><span class="line">    printByPrecision(decimal, precision);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;variable&#125; &#123;</span><br><span class="line">    ECHO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;expression&#125; &#123;</span><br><span class="line">    <span class="type">int</span> st = <span class="number">0</span>, flag = <span class="number">1</span>; <span class="comment">//st：当前数字的在字符串中开始的位置，flag：需要加还是减</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hasVar = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//判断是否有变量</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((yytext[i] == <span class="string">&#x27;+&#x27;</span> || yytext[i] == <span class="string">&#x27;-&#x27;</span>) &amp;&amp; !(yytext[i + <span class="number">1</span>] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; yytext[i + <span class="number">1</span>] &lt;= <span class="string">&#x27;9&#x27;</span> || yytext[i + <span class="number">1</span>] == <span class="string">&#x27;.&#x27;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            ECHO;</span><br><span class="line">            hasVar = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!hasVar)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> isfloat = <span class="number">0</span>; <span class="comment">//是否作为浮点数进行计算</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (yytext[i] == <span class="string">&#x27;.&#x27;</span> || yytext[i] == <span class="string">&#x27;e&#x27;</span> || yytext[i] == <span class="string">&#x27;E&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                isfloat = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isfloat)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> maxprecision = <span class="number">0</span>, precision = <span class="number">0</span>;</span><br><span class="line">            <span class="type">double</span> sum = <span class="number">0</span>; <span class="comment">//运算结果</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//遇到+-号就可以判断数字的起止位置</span></span><br><span class="line">                <span class="keyword">if</span> (yytext[i] == <span class="string">&#x27;+&#x27;</span> || yytext[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//如果是第一个符号，那么不进行计算，只更改符号</span></span><br><span class="line">                    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        flag = (yytext[i] == <span class="string">&#x27;+&#x27;</span>) ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">                        st = i + <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//如果前面不是E，那么进行计算，如果是E的话，认为是数字的一部分，交给str2double处理</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (yytext[i - <span class="number">1</span>] != <span class="string">&#x27;E&#x27;</span> &amp;&amp; yytext[i - <span class="number">1</span>] != <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">double</span> tmp = str2double(yytext, st, i, &amp;precision);</span><br><span class="line">                        <span class="keyword">if</span> (precision &gt; maxprecision)</span><br><span class="line">                            maxprecision = precision;</span><br><span class="line">                        sum += tmp * flag;</span><br><span class="line">                        flag = (yytext[i] == <span class="string">&#x27;+&#x27;</span>) ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">                        st = i + <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//遇到匹配末尾</span></span><br><span class="line">                <span class="keyword">if</span> (i == yyleng - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">double</span> tmp = str2double(yytext, st, yyleng, &amp;precision);</span><br><span class="line">                    <span class="keyword">if</span> (precision &gt; maxprecision)</span><br><span class="line">                        maxprecision = precision;</span><br><span class="line">                    sum += tmp * flag;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            printByPrecision(sum, maxprecision);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>; <span class="comment">//运算结果</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; yyleng; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//遇到+-号就可以判断数字的起止位置</span></span><br><span class="line">                <span class="keyword">if</span> (yytext[i] == <span class="string">&#x27;+&#x27;</span> || yytext[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//如果不是第一个符号，进行计算</span></span><br><span class="line">                    <span class="keyword">if</span> (i != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">int</span> tmp = str2int(yytext, st, i);</span><br><span class="line">                        sum += tmp * flag;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//整数情况下不存在E</span></span><br><span class="line">                    flag = (yytext[i] == <span class="string">&#x27;+&#x27;</span>) ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">                    st = i + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//遇到匹配末尾了</span></span><br><span class="line">                <span class="keyword">if</span> (i == yyleng - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> tmp = str2int(yytext, st, yyleng);</span><br><span class="line">                    sum += tmp * flag;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, sum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    yylex();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">杜某某</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
